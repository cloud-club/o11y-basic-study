# 1. 그라파나 관측 가능성

### LGTM 스택

- Loki: 로그 관리
- Grafana: 대시보드
- Tempo: 추적 관리
- Mimir: 메트릭 관리

### 애플리케이션 구성

- 미니오: 오픈소스 객체 스토리지. AWS 운영 환경일 경우 S3 사용
- 레디스: 오픈소스 캐시. 그라파나 헬름 차트에서는 멤캐시트 사용
- 콘술: 하시코프에서 관리하는 오픈소스 서비스 레지스트리. 그라파나 헬름 차트에서는 멤버리스트 사용
- 카프카: 데이터 분석 파이프라인

</br>

# 2. 로키 로그 관리

### 로키 기능

**로키 마이크로 서비스 모드**

- 컴포넌트를 개별 마이크로 서비스로 실행하면 마이크로 서비스의 개수를 늘려 확장할 수 있음. 마이크로 서비스 모드는 대규모 로키 클러스터 또는 확장과 클러스터 작업에 대한 제어가 필요한 클러스터에 권장됨

**로키 컴포넌트**
![KakaoTalk_20241202_212342909_01](https://github.com/user-attachments/assets/f1802eae-ecaf-4bf5-8cd2-f12ec6077c90)

- 디스트리뷰터(Distributor)
    - 들어오는 스트림을 처리함
    - 스트림을 수신하면 스트림의 정확성을 검증하고 구성된 테넌트의 제한 내에 있는지 확인
    - 그 다음 유효한 청크를 배치로 분할하고 병렬로 여러 인제스터에게 보냄
- 인제스터
    - 쓰기 경로의 장기 스토리지 백엔드(DynamoDB, S3, 카산드라 등)에 로그 데이터를 쓰고, 읽기 경로의 메모리 내 쿼리의 로그 데이터를 반환
- 쿼리 프런트엔드
    - 쿼리어의 API 엔드포인트를 제공하며 읽기 경로를 가속화하는데 사용
- 쿼리어
    - LogQL 쿼리 언어를 사용하여 쿼리를 처리하고 인제스터와 장기 저장소에서 로그를 가져옴

**일관된 해시 링**
![KakaoTalk_20241202_212342909_02](https://github.com/user-attachments/assets/242addeb-dce2-445f-9803-a694ed4ce63a)

- 장점
    - 고가용성을 구현
    - 클러스터의 수평 확장과 축소를 지원
- 모든 컴포넌트가 자동으로 해시 링으로 연결되지는 않으며 디스트리뷰터, 인제스터, 쿼리 스케줄러, 콤팩터, 롤러는 수동으로 해시링에 연결해야 함
- 링의 각 노드는 컴토넌트 인스턴스를 나타내며 각 노드에는 통신 정보를 보유하는 키-값 저장소가 있음