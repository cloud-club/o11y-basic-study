í”„ë¡œë©”í…Œìš°ìŠ¤ ì„œë²„ë¥¼ í¬í•¨í•œ í”„ë¡œë©”í…Œìš°ìŠ¤ ìƒíƒœê³„(ì‹œê³„ì—´ DB, ë¸”ë¡ ì²˜ë¦¬, ì•ŒëŒ, ì˜¤í† ìŠ¤ì¼€ì¼ë§)ëŠ” í´ë¼ìš°ë“œ ë„¤ì´í‹°ë¸Œë¥¼ êµ¬í˜„í•˜ëŠ” ë° ì¤‘ìš”í•˜ë‹¤. ë˜í•œ í”„ë¡œë©”í…Œìš°ìŠ¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê·¸ë¼íŒŒë‚˜ ê´€ì¸¡ ê°€ëŠ¥ì„± ì†”ë£¨ì…˜ì„ ê°œë°œí–ˆê¸° ë•Œë¬¸ì— ë‚´ë¶€ ì²˜ë¦¬ ë°©ì‹ê³¼ ìš´ì˜ ë°©ì‹ì´ ìœ ì‚¬í•˜ë‹¤. ê·¸ë ‡ê¸°ì— í”„ë¡œë©”í…Œìš°ìŠ¤ì˜ ë‚´ë¶€ ì›ë¦¬ë¥¼ ì´í•´í•˜ê³  ìˆìœ¼ë©´ ë¬¸ì œ ë°œìƒ ì‹œ í•´ê²°ì±…ì„ ê·¼ë³¸ì ì¸ í•´ê²°ì±…ì„ ì°¾ëŠ”ë° ë„ì›€ì´ ë  ê²ƒì´ë‹¤.

Â 
# í”„ë¡œë©”í…Œìš°ìŠ¤ ë°”ì´ë„ˆë¦¬ êµ¬ì„±
## 1ï¸âƒ£ í”„ë¡œë©”í…Œìš°ìŠ¤ì˜ ê¸°ëŠ¥
í”„ë¡œë©”í…Œìš°ìŠ¤ ê¸°ëŠ¥ì€ ìš´ì˜ìë¥¼ ìœ„í•œ ë©”íŠ¸ë¦­ ëª¨ë‹ˆí„°ë§, ê°œë°œìë¥¼ ìœ„í•œ exporter, ì˜¤í† ìŠ¤ì¼€ì¼ë§ ì„¤ì •, ì‹œê³„ì—´ DB, ì„œë¹„ìŠ¤ ëª¨ë‹ˆí„°ë¥¼ ì‚¬ìš©í•œ ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬, ì•ŒëŒê³¼ ì—…ë¬´ ê·œì¹™ ë“±ì´ ìˆë‹¤. í”„ë¡œë©”í…Œìš°ìŠ¤ì™€ ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” ê¸´ë°€í•˜ê²Œ ì—°ê²°ëœë‹¤. ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” ëŸ°íƒ€ì„ í”Œë«í¼ì´ê³ , ë‚˜ë¨¸ì§€ ìš´ì˜ê³¼ ìë™í™”ëŠ” í”„ë¡œë©”í…Œìš°ìŠ¤ë¥¼ í†µí•´ êµ¬í˜„í•œë‹¤. ì•„ë˜ ê·¸ë¦¼ì€ í”„ë¡œë©”í…Œìš°ìŠ¤ì˜ ê¸°ëŠ¥ê³¼ ì¿ ë²„ë„¤í‹°ìŠ¤ì™€ì˜ ê´€ê³„ë¥¼ ë‚˜íƒ€ë‚¸ ê²ƒì´ë‹¤.

í”„ë¡œë©”í…Œìš°ìŠ¤ ê¸°ëŠ¥

<br/>

#### í”„ë¡œë©”í…Œìš°ìŠ¤ ì˜¤í¼ë ˆì´í„° (Prometheus Operator)
- ì—­í• : ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ í”„ë¡œë©”í…Œìš°ìŠ¤ë¥¼ êµ¬ì„±í•  ë•Œ ìì›ê³¼ í”„ë¡œë¹„ì €ë‹ì„ ìˆ˜í–‰í•œë‹¤.
- ì„¤ì¹˜: í—¬ë¦„ì´ë‚˜ ì˜¤í¼ë ˆì´í„°ë¡œ í”„ë¡œë©”í…Œìš°ìŠ¤ë¥¼ ì„¤ì¹˜í•  ìˆ˜ ìˆë‹¤. (ê·¸ë¼íŒŒë‚˜ëŠ” í—¬ë¦„ ì°¨íŠ¸ë¥¼ ì‚¬ìš©í•œ ì„¤ì¹˜ë§Œ ê°€ëŠ¥í•˜ê³ , ì¶”í›„ì— ì˜¤í¼ë ˆì´í„° ë°©ì‹ë„ ì§€ì›í•  ì˜ˆì •ì´ë‹¤.)
- ë™ì‘ ë°©ì‹: ì˜¤í¼ë ˆì´í„°ê°€ ì„œë¹„ìŠ¤ì™€ íŒŒë“œì˜ ì¦ê°ì„ ëª¨ë‹ˆí„°ë§í•˜ê³ , ì¦ê° ë°œìƒ ì‹œ í”„ë¡œë©”í…Œìš°ìŠ¤ êµ¬ì„± íŒŒì¼ ì—…ë°ì´íŠ¸ (ì¿ ë²„ë„¤í‹°ìŠ¤ ë‚´ì— ë™ì ìœ¼ë¡œ ì¦ê°€í•˜ëŠ” ì„œë¹„ìŠ¤ì™€ íŒŒë“œë¥¼ ë°œê²¬ > ì˜¤í¼ë ˆì´í„° ë‚´ ServiceMonitorì™€ PodMonitorê°€ ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬ë¥¼ ì œê³µ)
Â 
#### í”„ë¡œë©”í…Œìš°ìŠ¤ ìµìŠ¤í¬í„° (Prometheus Exporter)
- ì—­í• : íŠ¹ì • ë©”íŠ¸ë¦­ì„ ìˆ˜ì§‘í•´ ì—”ë“œí¬ì¸íŠ¸ì— ë…¸ì¶œì‹œí‚¨ë‹¤. (ì—¬ëŸ¬ ì‹œìŠ¤í…œì— ëŒ€í•œ ìµìŠ¤í¬í„°, ê¸°ì¡´ ëª¨ë‹ˆí„°ë§ì— ì‚¬ìš©ë˜ëŠ” ì—ì´ì „íŠ¸ë“¤ê³¼ í†µí•©í•˜ëŠ” ìµìŠ¤í¬í„°ë„ ì¡´ì¬)
- íŠ¹ì§•: ê¸°ë³¸ ì œê³µ ìµìŠ¤í¬í„° ì™¸ì— ë„ë©”ì¸ì— ì í•©í•œ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ë©”íŠ¸ë¦­ ì¸¡ì •ì„ ìœ„í•´ ì»¤ìŠ¤í…€ ìµìŠ¤í¬í„°ëŠ” ì§ì ‘ ê°œë°œí•´ì•¼ í•¨ (í”„ë¡œë©”í…Œìš°ìŠ¤ê°€ API, SDK ì œê³µ)
Â 
#### í”„ë¡œë©”í…Œìš°ìŠ¤ ì–´ëŒ‘í„° (Prometheus Adapter)
- ì—­í• : ë³µì¡í•œ ì»¤ìŠ¤í…€ ë©”íŠ¸ë¦­ì„ ì¸¡ì •í•˜ê³ , HPAì™€ ì—°ê³„í•´ ì‹ ì†í•˜ê²Œ ì˜¤í† ìŠ¤ì¼€ì¼ë§ì„ êµ¬í˜„í•œë‹¤.
- íŠ¹ì§•: ê¸°ì¡´ ë©”íŠ¸ë¦­ ì„œë²„ëŠ” ê°„ë‹¨í•œ ê¸°ë³¸ ë©”íŠ¸ë¦­ë§Œ ì¸¡ì •í•  ìˆ˜ ìˆì§€ë§Œ, ì–´ëŒ‘í„°ëŠ” ë³µì¡í•œ ì»¤ìŠ¤í…€ ë©”íŠ¸ë¦­ ì§€ì›ì´ ê°€ëŠ¥í•˜ë‹¤.
- ë™ì‘ ë°©ì‹: ìµìŠ¤í¬í„°ë¥¼ í†µí•´ ì œê³µëœ ì»¤ìŠ¤í…€ ë©”íŠ¸ë¦­ì´ ì„œë²„ì— ì˜í•´ ìŠ¤í¬ë˜í•‘ë˜ê³ , ë©”íŠ¸ë¦­ ì¸¡ì •ê³¼ ì‹œìŠ¤í…œ ë¶€í•˜ ëŒ€ì‘ì„ ìœ„í•´ HPAë¥¼ í†µí•œ íŒŒë“œ ì˜¤í† ìŠ¤ì¼€ì¼ë§ì„ ìˆ˜í–‰í•œë‹¤.
Â 
> ğŸ’¡ ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ì—­í• ì´ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ í¬í•¨í•œ ì»¨í…Œì´ë„ˆ ìš´ì˜ ë° ìŠ¤ì¼€ì¤„ë§ì´ë¼ë©´, í”„ë¡œë©”í…Œìš°ìŠ¤ëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ ê¸°ë°˜ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì›í™œíˆ ëŒì•„ê°€ë„ë¡ ìš´ì˜ê³¼ ìë™í™”ë¥¼ ë‹´ë‹¹í•œë‹¤.
Â 
Â 
#### í”„ë¡œë©”í…Œìš°ìŠ¤ì˜ ë‚´ë¶€ ë™ì‘ ì›ë¦¬
1. ë©”íŠ¸ë¦­ ìˆ˜ì§‘ê³¼ ì‹œê³„ì—´ë¡œ ë©”íŠ¸ë¦­ì„ ì €ì¥í•œë‹¤.
2. ë©”íŠ¸ë¦­ ì¸¡ì •ê³¼ ë¦¬ì†ŒìŠ¤ë¥¼ ì˜¤í† ìŠ¤ì¼€ì¼ë§ ì²˜ë¦¬í•œë‹¤.
3. ë³€ê²½ëœ ë¦¬ì†ŒìŠ¤ë¥¼ ìë™ìœ¼ë¡œ ì°¾ëŠ”ë‹¤.
4. HPAì™€ ì—°ê³„í•´ ì¦ê°€í•œ ë¦¬ì†ŒìŠ¤ë¡œ ìœ ì € íŠ¸ë˜í”½ì„ ë¶„ë°°í•œë‹¤.
Â 
ì˜¤ë¥¸ìª½ ê·¸ë¦¼ì€ ë…¸ë“œ ìµìŠ¤í¬í„°ë¥¼ í†µí•´ í”„ë¡œë©”í…Œìš°ìŠ¤ë¡œ ì „ë‹¬ë˜ëŠ” ë©”íŠ¸ë¦­ì˜ ì´ë™ì„ ë³´ì—¬ì¤€ë‹¤
Â 

Â 
## 2ï¸âƒ£ ì˜ˆì œ - ìµìŠ¤í¬í„°
ë…¸ë“œ ìµìŠ¤í¬í„°ê°€ OS ì‹œìŠ¤í…œ ë©”íŠ¸ë¦­ì„ ìˆ˜ì§‘í•˜ê³  í”„ë¡œë©”í…Œìš°ìŠ¤ DBì— ì €ì¥í•˜ëŠ” ê³¼ì •ì„ ì‚´í´ë³´ì.
> ğŸ’¡ ì—¬ê¸°ì„œ ì ê¹!Node ExporterëŠ” í”„ë¡œë©”í…Œìš°ìŠ¤ ìµìŠ¤í¬í„° ì¤‘ í•˜ë‚˜ë¡œ, í•˜ë“œì›¨ì–´ì˜ ìƒíƒœì™€ ì»¤ë„ ê´€ë ¨ ë©”íŠ¸ë¦­ì„ ìˆ˜ì§‘í•˜ëŠ” ë©”íŠ¸ë¦­ ìˆ˜ì§‘ê¸°ì´ë‹¤. ë…¸ë“œ ìµìŠ¤í¬í„°ë¡œë¶€í„° ë©”íŠ¸ë¦­ì„ ìˆ˜ì§‘í•˜ë©´ í”„ë¡œë©”í…Œìš°ìŠ¤ ë‚´ì˜ TSDBì— ì €ì¥ë˜ê³ , PromQLë¡œ ë©”íŠ¸ë¦­ì„ ì¿¼ë¦¬í•´ ì„œë²„ ìƒíƒœë¥¼ ëª¨ë‹ˆí„°ë§í•  ìˆ˜ ìˆë‹¤.
Â 
Â 
##### 1. í”„ë¡œë©”í…Œìš°ìŠ¤ ì„¤ì¹˜

Installation | Prometheus
An open-source monitoring system with a dimensional data model, flexible query language, efficient time series database and modern alerting approach.
prometheus.io


```
#wget ëª…ë ¹ì–´ë¡œ ì••ì¶• íŒŒì¼ ë‹¤ìš´ë¡œë“œ
$ wget https://github.com/prometheus/prometheus/releases/download/v2.37.0/prometheus-2.37.0.linux-amd64.tar.gz
```

```
# ë‹¤ìš´ë°›ì€ ì••ì¶•íŒŒì¼ì˜ ì••ì¶• í•´ì œ
$ tar xzvf prometheus-2.37.0.linux-amd64.tar.gz
```
Â 
##### 2. yaml íŒŒì¼ ì„¤ì •
ë…¸ë“œ ìµìŠ¤í¬í„°ì˜ metrics HTTP endpointì— ì ‘ê·¼í•˜ëŠ” yamlì„ êµ¬ì„±í•œë‹¤.
```
# yaml íŒŒì¼ ì„¤ì •
$ cd prometheus-2.37.0.linux-amd64
$ vi prometheus.yml
```

```
#prometheus.yaml

global:
  scrape_interval: 15s
  evaluation_interval: 15s

scrape_configs:
  - job_name: "prometheus"
    static_configs:
    - targets: ["localhost:9090"]
    
  - job_name: "node"
    static_configs:
    - targets: ["localhost:9100"] # ë…¸ë“œ ìµìŠ¤í¬í„°ì˜ default port:9100
```
Â 
> ê° ì„¸ì…˜ì´ í•˜ëŠ” ì—­í• 
- global: ì „ì—­ ì„¤ì •
- scrape_interval: ë©”íŠ¸ë¦­ ìˆ˜ì§‘í•  ì£¼ê¸° ì„¤ì • (default: 1m)
- evaluation_interval: ê·œì¹™ í‰ê°€í•  ì£¼ê¸° ì„¤ì •Â (default: 1m)
- scrape_configs: ë©”íŠ¸ë¦­ì„ ìˆ˜ì§‘í•  ì—”ë“œí¬ì¸íŠ¸ ì„¤ì •
- job_name: ì´ ì„¤ì •ì—ì„œ ìˆ˜ì§‘í•œ íƒ€ì„ì‹œë¦¬ì¦ˆì— ëŒ€í•´ job=<job_name>ìœ¼ë¡œ ë¼ë²¨ ì¶”ê°€
- static_configs: íƒ€ê²Ÿê³¼ íƒ€ê²Ÿì— ëŒ€í•œ ë¼ë²¨ ì§€ì •
- targets: ë©”íŠ¸ë¦­ì„ ìˆ˜ì§‘í•  ì—”ë“œí¬ì¸íŠ¸ ì§€ì •
Â 
Â 
##### 3. Serviceì˜ Userë¥¼ í”„ë¡œë©”í…Œìš°ìŠ¤ë¡œ ì§€ì •í•˜ê³  ë¦¬ëˆ…ìŠ¤ ì‹œìŠ¤í…œì— ë“±ë¡í•˜ëŠ” íŒŒì¼ ì‘ì„±

```
#prometheus.service

[Unit]
Description=Prometheus
Wants=network-online.target
After=network-online.target

[Service]
User=prometheus
Group=prometheus
Type=simple
ExecStart= /usr/local/bin/prometheus\
  --config.file /etc/prometheus/prometheus.yaml \
  --storage.tsdb.path /var/lib/prometheus/\
  --web.console.templates=/etc/prometheus/consoles\
  --web.console.libraries=/etc/prometheus/console_libraries\
  --storage.tsdb.max-block-duration=1m\ #default: 2h
  --storage.tsdb.min-block-duration=1m\ #default: 2h
  --web.enable-lifecycle \
  --web.enable-admin-api \
  --log.level=info
  
[Install]
WantedBy=multi-user.target
```
Â 
##### 4. í”„ë¡œë©”í…Œìš°ìŠ¤ ì‹œì‘
í”„ë¡œë©”í…Œìš°ìŠ¤ë¥¼ ì‹œì‘í•˜ëŠ” ëª…ë ¹ì–´ë¥¼ í†µí•´ ìœ„ì˜ íŒŒì¼ì„ ì‹œì‘í•œë‹¤.

```
$ systemctl start prometheus
$ systemctl status prometheus
```
Â 
##### 5. ë…¸ë“œ ìµìŠ¤í¬í„° ë‹¤ìš´

```
$ tar xvfz node_exporter-1.3.1.linux.amd64.tar.gz
```
Â 
##### 6. node_exporter.service íŒŒì¼ ì‘ì„±
ì‹œìŠ¤í…œ ë“±ë¡ì„ ìœ„í•´ rootë¡œ ì‚¬ìš©ì íŒŒì¼ ì‘ì„±

```
#node_exporter.service

[Unit]
Description=node-exporter
After=network-online.target

[Service]
Type=simple
User=root
Group=root
SyslogIcentifier=node-exporter
WorkingDirectory=/root/node_exporter-1.3.1.linux-amd64
Restart=always
RestartSec=0s
ExecStart=/root/node_exporter-1.3.1.linux-amd64/node_exporter

[Install]
WantedBy=multi-user.target
```
Â 
##### 7. ë…¸ë“œ ìµìŠ¤í¬í„° ì‹¤í–‰ ë° ìƒíƒœ í™•ì¸

```
$ systemctl start node-exporter
$ systemctl status node-exporter
```
Â 
Â 

ì¶œì²˜: https://youjava.tistory.com/46 [Software Engineerê°€ ë ë˜ìš”:í‹°ìŠ¤í† ë¦¬]